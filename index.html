<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Test bundle.js - Fullscreen iframe</title>
<style>
   html, body {
     height: 100%;
     margin: 0;
   }
   body { font-family: Arial, sans-serif; }
   /* Schermata iniziale */
   #launcher {
     height: 100vh;
     display: flex;
     align-items: center;
     justify-content: center;
   }
   /* Contenitore iframe full screen */
   #host {
     height: 100vh;
     display: none; /* nascosto finché non clicchi */
   }
   /* wrapper del bundle */
   #host .sfdc-component,
   #host .scroll-wrapper {
     height: 100%;
   }
   /* iframe full screen */
   #host iframe {
     width: 100%;
     height: 100%;
     border: 0;
     display: block;
   }
</style>
</head>
<body>
<div id="launcher">
<button id="openLead">Apri Lead</button>
</div>
<div id="host"></div>
<!-- il tuo bundle -->
<script src="./bundle.js"></script>
<script>
   // Base corretta (serve al Lightning.generateUrl nel bundle)
   const COMMUNITY_URI = "https://ppcrmagenti.axa-italia.it/tabs/";
   // Forza fallback (come nel sito reale)
   localStorage.setItem("fallback", "true");
   // IMPORTANTE: window.Application deve essere l'istanza reale del controller del bundle
   window.Application = new window.AxaApplication(
     {},
     (authParams) => console.log("[authCallback]", authParams)
   );
   // Fallback communityURI usato dal Lightning se non trova customUrl in URL/hash
   if (window.SalesforceAuth) {
     window.SalesforceAuth.communityURI = COMMUNITY_URI;
   }
   // Log messaggi dall’iframe (HOOK_REQUEST / AUTH_REFRESH ecc.)
   window.addEventListener("message", (e) => {
     if (e.data?.action) console.log("[FROM IFRAME]", e.data);
   });
   document.getElementById("openLead").onclick = () => {
     // Vai fullscreen: nascondi launcher e mostra solo iframe
     document.getElementById("launcher").style.display = "none";
     document.getElementById("host").style.display = "block";
     const host = document.getElementById("host");
     host.innerHTML = '<div id="mobilityLeadListView"></div>';
     // Questo monta React/Lightning e crea l’iframe
     new window.SalesforceConnect(
       "mobilityLeadListView",      // component
       "mobilityLeadListView",      // container id
       {
         auth: true,                // forza authenticated nel Lightning
         lwc: false,                // iframe mode
         visualforce: "javascriptIntegration",
         // params → querystring dell’iframe
         widget: true,
         limit: 5,
         DefaultFilter: "All",
         breadcrumb: [{ label: "Homepage" }]
       }
     );
     // Debug: stampa src iframe dopo creazione
     setTimeout(() => {
       const iframe = document.getElementById("mobilityLeadListView");
       console.log("[iframe src]", iframe?.getAttribute("src"));
     }, 600);
   };
</script>
</body>
</html>
