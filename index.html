<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Test bundle.js - Fullscreen iframe</title>
<style>
   html, body { height: 100%; margin: 0; }
   body { font-family: Arial, sans-serif; overflow: hidden; }
   #launcher { height: 100vh; display:flex; align-items:center; justify-content:center; }
   #host { height: 100vh; display:none; }
   #host .sfdc-component,
   #host .scroll-wrapper {
     height: 100vh !important;
     overflow: hidden !important;
   }
   #host iframe {
     width: 100%;
     height: 100vh !important;
     border: 0;
     display: block;
   }
</style>
</head>
<body>
<div id="launcher">
<button id="openLead">Apri Lead</button>
</div>
<div id="host"></div>
<script src="./bundle.js"></script>
<script>
   const COMMUNITY_URI = "https://ppcrmagenti.axa-italia.it/tabs/";
   localStorage.setItem("fallback", "true");
   window.Application = new window.AxaApplication({}, (authParams) => console.log("[authCallback]", authParams));
   if (window.SalesforceAuth) {
     window.SalesforceAuth.communityURI = COMMUNITY_URI;
   }
   // log messaggi dal child
   window.addEventListener("message", (e) => {
     if (e.data?.action) console.log("[FROM IFRAME]", e.data);
   });
   // resize continuo
   window.addEventListener("resize", () => {
     const iframe = document.getElementById("mobilityLeadListView");
     if (!iframe?.contentWindow) return;
     iframe.contentWindow.postMessage({
       action: "RESIZE",
       data: {
         height: window.innerHeight,
         width: window.innerWidth,
         type: "desktop"
       }
     }, "*");
   });
   document.getElementById("openLead").onclick = () => {
     document.getElementById("launcher").style.display = "none";
     document.getElementById("host").style.display = "block";
     const host = document.getElementById("host");
     host.innerHTML = '<div id="mobilityLeadListView"></div>';
     new window.SalesforceConnect(
       "mobilityLeadListView",
       "mobilityLeadListView",
       {
         auth: true,
         lwc: false,
         visualforce: "javascriptIntegration",
         widget: true,
         limit: 5,
         DefaultFilter: "All",
         breadcrumb: [{ label: "Homepage" }]
       }
     );
     // forza resize/refresh dopo mount
     setTimeout(() => {
       const iframe = document.getElementById("mobilityLeadListView");
       if (!iframe) return;
       iframe.style.height = "100vh";
       // manda resize/refresh al child
       iframe.contentWindow?.postMessage({
         action: "RESIZE",
         data: {
           height: window.innerHeight,
           width: window.innerWidth,
           type: "large-desktop"
         }
       }, "*");
       iframe.contentWindow?.postMessage({ action: "REFRESH" }, "*");
     }, 1200);
   };
</script>
</body>
</html>
