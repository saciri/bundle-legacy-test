<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Test bundle.js - Mobility Lead</title>
<style>
   body { font-family: Arial, sans-serif; }
   button { padding: 10px 16px; font-size: 16px; cursor: pointer; }
   #host { margin-top: 16px; }
</style>
</head>
<body>
<button id="openLead">Apri Lead (via bundle)</button>
<div id="host"></div>
<!-- il tuo bundle -->
<script src="./bundle.js"></script>
<script>
   // 1) Base corretta (serve a Lightning.generateUrl())
   const COMMUNITY_URI = "https://ppcrmagenti.axa-italia.it/tabs/";
   // 2) Forza "autenticato" per far renderizzare Lightning (altrimenti return null)
   //    Il tuo codice fa: let authenticated = window.Application.authenticated;
   //    e poi render() ritorna null se non autenticato.
   localStorage.setItem("fallback", "true");
   // 3) Questo è il punto che ti mancava:
   //    window.Application deve essere l'ISTANZA del controller del bundle, non un oggetto finto.
   //    NON sovrascrivere window.Application con un plain object.
   window.Application = new window.AxaApplication(
     {}, // params (se il tuo bundle li usa li aggiungiamo dopo)
     (authParams) => console.log("[authCallback]", authParams)
   );
   // 4) Imposta anche il fallback della communityURI usato da Lightning.communityURI
   //    (nel tuo snippet: return SalesforceAuth.communityURI)
   if (window.SalesforceAuth) {
     window.SalesforceAuth.communityURI = COMMUNITY_URI;
   }
   // 5) Click: crea SalesforceConnect -> monta React Lightning -> crea l’IFRAME
   document.getElementById("openLead").onclick = () => {
     const host = document.getElementById("host");
     host.innerHTML = '<div id="mobilityLeadListView"></div>';
     new window.SalesforceConnect(
       "mobilityLeadListView",      // component (c:mobilityLeadListView lato VF)
       "mobilityLeadListView",      // htmlId container
       {
         // IMPORTANTI per il tuo Lightning:
         auth: true,                // forza authenticated=true in constructor(props)
         lwc: false,                // vogliamo iframe mode (renderIframe)
         visualforce: "javascriptIntegration",
         // parametri che finiscono in querystring (queryString esclude customUrl)
         widget: true,
         limit: 5,
         DefaultFilter: "All",
         breadcrumb: [{ label: "Homepage" }]
       }
     );
     // Debug: dopo il click controlla che l’iframe esista
     setTimeout(() => {
       const iframe = document.getElementById("mobilityLeadListView");
       console.log("[iframe]", iframe && iframe.getAttribute("src"));
     }, 500);
   };
</script>
</body>
</html>
